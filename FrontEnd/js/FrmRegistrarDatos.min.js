var objEmpresa;function cargarDatosEmail(e){$.ajax({type:"POST",url:"ws/WSEmpresas.asmx/getDatos",data:e,contentType:"application/json; utf-8",dataType:"json",success:function(o){o.d>0?($("#titulo").text("EDITAR DATOS DE CONTACTO"),$("#btnRegistrar").val("Editar"),$.ajax({type:"POST",url:"ws/WSEmpresas.asmx/getOneEmail",data:e,contentType:"application/json; utf-8",dataType:"json",success:function(e){objEmpresa=JSON.parse(e.d),window.sessionStorage.setItem("id_municipio",objEmpresa[0].id_municipio),$("#contenido_txtEmpresa").val(objEmpresa[0].nombre),$("#contenido_txtEmail").val(objEmpresa[0].email),$("#contenido_txtCP").val(objEmpresa[0].codigo_postal),$("#contenido_txtDomicilio").val(objEmpresa[0].domicilio),$("#contenido_txtTelefono").val(objEmpresa[0].telefono),$("#contenido_txtMision").val(objEmpresa[0].mision),"Industrial"==objEmpresa[0].giro?document.getElementById("contenido_RadioIndustrial").checked=!0:"Servicios"==objEmpresa[0].giro?document.getElementById("contenido_RadioServicios").checked=!0:"Otro"==objEmpresa[0].giro&&(document.getElementById("contenido_RadioOtro").checked=!0),"Público"==objEmpresa[0].sector?document.getElementById("contenido_RadioPublico").checked=!0:"Privado"==objEmpresa[0].sector&&(document.getElementById("contenido_RadioPrivado").checked=!0),cargarEstados()},error:function(e,o,t){"System.Exception"==e.responseJSON.ExceptionType?($("#msgError").text(e.responseJSON.Message),$("#mdlError").modal().show()):"System.Security.SecurityException"==e.responseJSON.ExceptionType&&Response.load("FrmLogin.aspx")}})):(window.sessionStorage.setItem("id_municipio",0),cargarEstados())},error:function(e,o,t){"System.Exception"==e.responseJSON.ExceptionType?($("#msgError").text(e.responseJSON.Message),$("#mdlError").modal().show()):"System.Security.SecurityException"==e.responseJSON.ExceptionType&&Response.load("FrmLogin.aspx")}})}function cargarDatosID(){$("#titulo").text("EDITAR DATOS DE CONTACTO"),$("#btnRegistrar").val("Editar");var e=window.sessionStorage.getItem("id_empresa"),o="{ 'id_empresa' : '"+parseInt(e)+"'}";$.ajax({type:"POST",url:"ws/WSEmpresas.asmx/getOne",data:o,contentType:"application/json; utf-8",dataType:"json",success:function(e){objEmpresa=JSON.parse(e.d),window.sessionStorage.setItem("id_municipio",objEmpresa[0].id_municipio),$("#contenido_txtEmpresa").val(objEmpresa[0].nombre),$("#contenido_txtEmail").val(objEmpresa[0].email),$("#contenido_txtCP").val(objEmpresa[0].codigo_postal),$("#contenido_txtDomicilio").val(objEmpresa[0].domicilio),$("#contenido_txtTelefono").val(objEmpresa[0].telefono),$("#contenido_txtMision").val(objEmpresa[0].mision),"Industrial"==objEmpresa[0].giro?document.getElementById("contenido_RadioIndustrial").checked=!0:"Servicios"==objEmpresa[0].giro?document.getElementById("contenido_RadioServicios").checked=!0:"Otro"==objEmpresa[0].giro&&(document.getElementById("contenido_RadioOtro").checked=!0),"Público"==objEmpresa[0].sector?document.getElementById("contenido_RadioPublico").checked=!0:"Privado"==objEmpresa[0].sector&&(document.getElementById("contenido_RadioPrivado").checked=!0),cargarEstados()},error:function(e,o,t){"System.Exception"==e.responseJSON.ExceptionType?($("#msgError").text(e.responseJSON.Message),$("#mdlError").modal().show()):"System.Security.SecurityException"==e.responseJSON.ExceptionType&&Response.load("FrmLogin.aspx")}})}function cargarMunicipios(e){$.ajax({type:"POST",url:"ws/WSDatosContacto.asmx/getMunicipios",data:e,contentType:"application/json; utf-8",dataType:"json",success:function(e){let o=JSON.parse(e.d);for($("#contenido_ddlMunicipio").empty(),i=0;i<o.length;i++)$("#contenido_ddlMunicipio").append('<option value="'+o[i].id_municipio+'">'+o[i].municipio+"</option>");objEmpresa&&objEmpresa[0].id_municipio?($("#contenido_ddlMunicipio").val(objEmpresa[0].id_municipio),delete objEmpresa[0].id_municipio):$("#contenido_ddlMunicipio").val($("#contenido_ddlMunicipio option:first").val())},error:function(e,o,t){$("#msgError").text("HA OCURRIDO UN ERROR, POR FAVOR VUELVELO A INTENTAR"),$("#mdlError").modal().show()}})}function cerrar_modal(e){window.location.assign("FrmContenedor.aspx")}function cargarEstados(){$.ajax({type:"POST",url:"ws/WSDatosContacto.asmx/getEstados",contentType:"application/json; utf-8",dataType:"json",success:function(e){let o=JSON.parse(e.d);for($("#contenido_ddlEstado").empty(),i=0;i<o.length;i++)$("#contenido_ddlEstado").append('<option value="'+o[i].id_estado+'">'+o[i].estado+"</option>");if(objEmpresa&&objEmpresa[0].id_estado){$("#contenido_ddlEstado").val(objEmpresa[0].id_estado);var t=$("#contenido_ddlEstado :selected").text();cargarMunicipios("{ 'estado' : '"+t+"'}")}else{$("#contenido_ddlEstado").val($("#contenido_ddlEstado option:first").val()),cargarMunicipios("{ 'estado' : '"+t+"'}")}},error:function(e,o,t){$("#msgError").text("HA OCURRIDO UN ERROR, POR FAVOR VUELVELO A INTENTAR"),$("#mdlError").modal().show()}})}$(document).ready(function(){var e=document.getElementById("contenido_txtEmpresa"),o=document.getElementById("contenido_txtEmail"),t=document.getElementById("contenido_txtDomicilio"),i=document.getElementById("contenido_txtCP"),a=document.getElementById("contenido_txtTelefono"),n=document.getElementById("contenido_txtMision"),s=document.getElementById("contenido_RadioPublico"),r=document.getElementById("contenido_RadioPrivado"),d=document.getElementById("contenido_RadioIndustrial"),c=document.getElementById("contenido_RadioServicios"),m=document.getElementById("contenido_RadioOtro");new RegExp("^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.([a-zA-Z]{2,4})+$");$("#btnRegistrar").click(function(){if($("#FrmRegistrarDatos").data("bootstrapValidator").validate(),$("#FrmRegistrarDatos").data("bootstrapValidator").isValid()){var l=e.value.trim(),p=o.value.trim(),E=i.value.trim(),u=t.value.trim(),g=a.value.trim(),y=n.value.trim(),x=s.checked,b=r.checked,v=d.checked,S=c.checked,_=m.checked,O=document.getElementById("contenido_ddlEstado").value,R=document.getElementById("contenido_ddlMunicipio").value;document.getElementById("btnAceptarInfo").addEventListener("click",cerrar_modal);var f="",I="";x?I="Público":b&&(I="Privado"),v?f="Industrial":_?f="Otro":S&&(f="Servicios");let h={};h.nombre=l,h.email=p,h.id_estado=O,h.id_municipio=R,h.codigo_postal=E,h.domicilio=u,h.giro=f,h.sector=I,h.telefono=g,h.mision=y;var j="{'info' : '"+JSON.stringify(h)+"'}",T=document.getElementById("btnRegistrar");if("Registrar"==T.value)$.ajax({type:"POST",url:"ws/WSDatosContacto.asmx/insert",data:j,contentType:"application/json; utf-8",dataType:"json",success:function(e){parseInt(e.d)>0?$("#mdlInformacion").modal("show"):($("#msgError").text("HA OCURRIDO UN ERROR, POR FAVOR VUELVELO A INTENTAR"),$("#mdlError").modal().show())},error:function(e,o,t){"System.Exception"==e.responseJSON.ExceptionType?($("#msgError").text(e.responseJSON.Message),$("#mdlError").modal().show()):"System.Security.SecurityException"==e.responseJSON.ExceptionType&&Response.load("FrmLogin.aspx")}});else if("Editar"==T.value){var w=window.sessionStorage.getItem("id_empresa");if(null!=w){let e={};e.id_empresa=w,e.nombre=l,e.email=p,e.id_estado=O,e.id_municipio=R,e.codigo_postal=E,e.domicilio=u,e.giro=f,e.sector=I,e.telefono=g,e.mision=y;j="{'info' : '"+JSON.stringify(e)+"'}";$.ajax({type:"POST",url:"ws/WSDatosContacto.asmx/update",data:j,contentType:"application/json; utf-8",dataType:"json",success:function(e){e.d?($("#mdlInformacion").modal("show"),window.sessionStorage.removeItem("id_empresa")):($("#msgError").text("HA OCURRIDO UN ERROR, POR FAVOR VUELVELO A INTENTAR"),$("#mdlError").modal().show())},error:function(e,o,t){"System.Exception"==e.responseJSON.ExceptionType?($("#msgError").text(e.responseJSON.Message),$("#mdlError").modal().show()):"System.Security.SecurityException"==e.responseJSON.ExceptionType&&Response.load("FrmLogin.aspx")}})}else if(null==w){var N=$("#contenido_txtEmailUsuario").val();let e={};e.nombre=l,e.email=p,e.id_estado=O,e.id_municipio=R,e.codigo_postal=E,e.domicilio=u,e.giro=f,e.sector=I,e.telefono=g,e.mision=y,e.email_usuario=N;j="{'info' : '"+JSON.stringify(e)+"'}";$.ajax({type:"POST",url:"ws/WSDatosContacto.asmx/updatePorEmail",data:j,contentType:"application/json; utf-8",dataType:"json",success:function(e){e.d?$("#mdlInformacion").modal("show"):($("#msgError").text("HA OCURRIDO UN ERROR, POR FAVOR VUELVELO A INTENTAR"),$("#mdlError").modal().show())},error:function(e,o,t){"System.Exception"==e.responseJSON.ExceptionType?($("#msgError").text(e.responseJSON.Message),$("#mdlError").modal().show()):"System.Security.SecurityException"==e.responseJSON.ExceptionType&&Response.load("FrmLogin.aspx")}})}}}}),$("#FrmRegistrarDatos").bootstrapValidator({framework:"bootstrap",excluded:[":disabled",":hidden"],fields:{ctl00$contenido$txtEmpresa:{message:"Nombre de la Empresa no valido",validators:{notEmpty:{message:"Este campo es obligatorio y no debe estar vacio."},regexp:{regexp:/^[a-zA-Z\s0-9]+$/,message:"Se debe colocar un nombre valido y no puede tener caracteres especiales."},stringLength:{min:5,max:60,message:"El nombre de la empresa debe tener entre 5 y 60 caracteres"}}},ctl00$contenido$txtEmail:{message:"Email no valido",validators:{notEmpty:{message:"Este campo es obligatorio y no debe estar vacio."},regexp:{regexp:/^([\w-]+\.)*?[\w-]+@[\w-]+\.([\w-]+\.)*?[\w]+$/,message:"El Email no es valido un ejmeplo es: ejemplo@emplo.com"}}},ctl00$contenido$ddlEstado:{validators:{notEmpty:{message:"Debes seleccionar un estado de la lista desplegable."},callback:{message:"Se debe seleccionar un estado.",callback:function(e,o,t){return e>0&&e<33}}}},ctl00$contenido$ddlMunicipio:{validators:{notEmpty:{message:"Debes seleccionar un municipio de la lista desplegable."},callback:{message:"Se debe seleecionar un municipio.",callback:function(e,o,t){return e>0&&e<2279}}}},ctl00$contenido$txtCP:{message:"Codigo postal no valido.",validators:{notEmpty:{message:"Este campo es obligatorio y no debe estar vacio."},regexp:{regexp:/(^([0-9]{5,5})|^)$/,message:"El código postal se debe componer de 5 dígitos numéricos"}}},ctl00$contenido$txtDomicilio:{message:"Domicilio no valido",validators:{notEmpty:{message:"Este campo es obligatorio y no debe estar vacio."},regexp:{regexp:/^[a-zA-Z\s]+([#]?[0-9\s]{1,4})?([a-zA-Z\s]{1,1})?$/,message:"La direccion debe contener al menos 5 caracteres y debe iniciar con letras ej: itsur ó itsur#23 ó itsur#1234A"},stringLength:{min:5,max:80,message:"La longitud del domicilio de ser entre 5 y 80 caracteres"}}},ctl00$contenido$Giro:{validators:{notEmpty:{message:"Es necesario indicar que tipo de GIRO tiene la empresa."},callback:{message:"Es necesario indicar que tipo de GIRO tiene la empresa",callback:function(e,o,t){return e.length>3||e.length<11}}}},ctl00$contenido$Sector:{validators:{notEmpty:{message:"Es necesario indicar de que tipo de sector es la empresa"},callback:{message:"Es necesario indicar el tipo de sector de la empresa",callback:function(e,o,t){return e.length>6||e.length<11}}}},ctl00$contenido$txtTelefono:{message:"El Telefono no es valido",validators:{notEmpty:{message:"Este campo es obligatorio y no debe estar vacio."},phone:{country:"US",message:"El número de teléfono no es valido, solo debe contener 10 digitos numéricos"}}},ctl00$contenido$txtMision:{message:"Mision no valida",validators:{notEmpty:{message:"Este campo es obligatorio y no debe estar vacio."},regexp:{regexp:/^[a-zA-Z\s]+$/,message:"La mision debe ser valida y solamente se admiten letras"},stringLength:{min:5,max:100,message:"Indica las características más importantes de la mision con una longitud de 5 a 100 caracteres"}}}}});var l=window.sessionStorage.getItem("id_empresa");window.sessionStorage.setItem("id_municipio",null);var p=$("#contenido_txtEmailUsuario").val();null!=p&&""!=p&&null==l?cargarDatosEmail("{ 'email' : '"+p+"'}"):null!=l&&cargarDatosID();$("#contenido_ddlEstado").change(function(){cargarMunicipios("{ 'estado' : '"+$("#contenido_ddlEstado :selected").text()+"'}")}),$("#btnCancelar").click(function(){window.sessionStorage.removeItem("id_empresa"),window.location.assign("FrmContenedor.aspx")})});